---
title: 纯css实现黑客帝国效果
date: 2019-07-07 19:21:58
tags: 
- js
- 动画
---

> 本篇介绍的是类似黑客帝国满屏的二进制编码效果，同理下雨和流星雨也可以这么耍


先来上效果：

![](https://cdn.sinaimg.cn.52ecy.cn/large/005BYqpgly1g4u1lo97ybg30qi078tj9.jpg)


我们仔细观察一下，这是由一张图片随机重复多次，并且每张图不断向下改变位置而产生动画的效果，那么我们来一步步拆解一下

首先学习一个知识点：（可能大家早就知道这个，我不知道，就当知识点写了哈）

设置多张背景图的写法：`background: url(xx.png),url(xx.png)`用逗号分隔开

### 原料：

一个合适大小的div

一张如下图所示的图片，充满了010101010的科技感图片

### 过程：

1. 生成一张随机位置的该图

其实不算完全随机，因为初始时y轴的坐标可以固定在div上方，只随机生成x轴坐标即可

代码如下：
```js
function randomBgs(bgArr) {
    let num = parseInt(Math.random() * 8 + 1, 10) ;
 
    while (num) {
        let posx = Math.floor(Math.random()*(1160 + 1));
        let repeated = bgArr.some(item => item.posx === posx);
        while (repeated) {
            posx = Math.floor(Math.random()*(1160 + 1));
            repeated = bgArr.some(item => item.posx === posx);
        }
        const posy = -HEIGHT;
        const duration = parseInt(Math.random()*3001+2000,10);
        const startTime = 0;
        bgArr.push({
            posx, posy, duration, startTime
            });
        num--
    }
  return bgArr
}
```

2. 
```js
movingNumsBg($dom, 800)
function movingNumsBg(dom, interval) {
    const bgs = randomBgs([]);
    let startTime = 0;
    function Linear(b, c, d, t) {
        return c * t / d + b;
    }
    function step(timestamp) {
        if (!startTime) {
            startTime = timestamp
        }
        const progress = timestamp - startTime;
        if (progress > interval) {
            startTime = timestamp
            randomBgs(bgs);
        }
        const positions = bgs.map((bg) => {
            if(!bg.startTime) {
                bg.startTime = timestamp;
            }
            bg.posy = parseInt(Linear(-HEIGHT, 510, bg.duration, timestamp - bg.startTime));
            return `url(/chart/udatav/getimagebyid?id=39d72daef67c45809c0fec948f8826a7.png) ${bg.posx}px ${bg.posy}px no-repeat`;
        }).join(',');
        dom.css('background', positions);
        
        for(let i = 0; i < bgs.length; i++) {
            if (bgs[i].posy >= HEIGHT) {
                bgs.splice(i, 1);
                i = i - 1;
            }
        }
        requestAnimationFrame(step);
    }
    requestAnimationFrame(step);
}
```

